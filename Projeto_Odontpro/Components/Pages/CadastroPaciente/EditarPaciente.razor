@page "/pacientes/{Id:int}/editar"
@rendermode InteractiveServer

@using Projeto_Odontpro.Models.Paciente;
@inject PacienteDAO pacienteDAO;
@inject NavigationManager Navigation;

<h1 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-6">
    Atualizar Paciente - @paciente.Nome
</h1>

@if (!string.IsNullOrEmpty(erro))
{
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
        <strong class="font-bold">Erro!</strong>
        <span class="block sm:inline">@erro</span>
    </div>
}

<EditForm Model="paciente" OnSubmit="Salvar" FormName="EditarPaciente">


    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Código</label>
        <input value="@paciente.Id" disabled
               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" />
    </div>


    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Nome do Paciente</label>
        <input @bind="paciente.Nome" type="text"
               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" />
    </div>


    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Sexo</label>
        <select @bind="paciente.Sexo"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
            <option value="">Selecione...</option>
            <option value="M">Masculino</option>
            <option value="F">Feminino</option>
            <option value="O">Outro</option>
        </select>
    </div>


    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Telefone</label>
        <input @bind="paciente.Telefone" type="text"
               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" />
    </div>

    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Data de Nascimento</label>
        <input @bind="paciente.Nascimento" type="date"
               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" />
    </div>

    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Estado</label>
        <select @bind="paciente.Estado"
                class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
            <option value="">Selecione...</option>
            <option value="AC">Acre</option>
            <option value="AL">Alagoas</option>
            <option value="AP">Amapá</option>
            <option value="AM">Amazonas</option>
            <option value="BA">Bahia</option>
            <option value="CE">Ceará</option>
            <option value="DF">Distrito Federal</option>
            <option value="ES">Espírito Santo</option>
            <option value="GO">Goiás</option>
            <option value="MA">Maranhão</option>
            <option value="MT">Mato Grosso</option>
            <option value="MS">Mato Grosso do Sul</option>
            <option value="MG">Minas Gerais</option>
            <option value="PA">Pará</option>
            <option value="PB">Paraíba</option>
            <option value="PR">Paraná</option>
            <option value="PE">Pernambuco</option>
            <option value="PI">Piauí</option>
            <option value="RJ">Rio de Janeiro</option>
            <option value="RN">Rio Grande do Norte</option>
            <option value="RS">Rio Grande do Sul</option>
            <option value="RO">Rondônia</option>
            <option value="RR">Roraima</option>
            <option value="SC">Santa Catarina</option>
            <option value="SP">São Paulo</option>
            <option value="SE">Sergipe</option>
            <option value="TO">Tocantins</option>
        </select>
    </div>

    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Endereço</label>
        <input @bind="paciente.Endereco" type="text"
               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" />
    </div>


    <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">Observações</label>
        <textarea @bind="paciente.Observacoes"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"
                  rows="4"></textarea>
    </div>

    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">
        Salvar
    </button>

</EditForm>

@code {
    private string erro = string.Empty;

    [Parameter]
    public int Id { get; set; }

    private Paciente paciente = new();

    protected override void OnInitialized()
    {
        var encontrado = pacienteDAO.BuscarPorId(Id);

        if (encontrado != null)
            paciente = encontrado;
        else
            erro = "Paciente não encontrado.";
    }

    private void Salvar()
    {
        try
        {
            pacienteDAO.Atualizar(paciente);
            Navigation.NavigateTo("/pacientes");
        }
        catch (Exception ex)
        {
            erro = $"Erro ao salvar o paciente: {ex.Message}";
        }
    }
}