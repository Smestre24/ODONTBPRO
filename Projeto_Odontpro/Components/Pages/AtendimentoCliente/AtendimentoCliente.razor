@page "/AtendimentoCliente"
@using System.Threading.Tasks

<div class="container">
    <div class="card">
      
        <div class="card-header">ATENDIMENTO AO CLIENTE</div>
        
        <div class="card-body">
            <label for="msg">Insira aqui a mensagem automática/lembrete:</label>
            <textarea id="msg" class="message-box" placeholder="Digite sua mensagem..." @bind="Message" rows="6"></textarea>

            <div class="checkbox-row">
                <label for="selectAll">Selecionar todos os nomes ativos do banco de dados.</label>
                <input id="selectAll" type="checkbox" @bind="SelectAllEmails" />
               
            </div>

            <div class="actions">
                <button class="btn"><i class="bi bi-box-seam"></i> ENVIAR</button>
                
            </div>

            @if (!string.IsNullOrEmpty(Notification))
            {
                <div class="notification @NotificationType">@Notification</div>
            }
        </div>
    </div>
</div>

@code {
    private string Message { get; set; } = "";
    private bool SelectAllEmails { get; set; } = false;
    private bool IsSending { get; set; } = false;
    private string Notification { get; set; } = "";
    private string NotificationType { get; set; } = ""; 


    private bool CanProceed => !string.IsNullOrWhiteSpace(Message);

    private async Task OnProceed()
    {
        Notification = "";
        NotificationType = "";

        if (!CanProceed)
        {
            NotificationType = "error";
            Notification = "Por favor, digite uma mensagem antes de prosseguir.";
            return;
        }

        IsSending = true;
        try
        {
            
            await Task.Delay(1000);

           
            NotificationType = "success";
            Notification = SelectAllEmails
                ? "Mensagem pronta para envio a todos os e-mails ativos."
                : "Mensagem salva. Selecione destinatários para enviar.";

         
        }
        catch (Exception ex)
        {
            NotificationType = "error";
            Notification = "Ocorreu um erro ao processar: " + ex.Message;
        }
        finally
        {
            IsSending = false;
        }
    }
}
