@page "/AtendimentoCliente"
@using System.Threading.Tasks

<div class="card-container">
    <div class="card">
        <div class="card-header">ATENDIMENTO AO CLIENTE</div>

        <div class="card-body">
            <label for="msg">Insira aqui a mensagem automática/lembrete:</label>
            <textarea id="msg" class="message-box" placeholder="Digite sua mensagem..."
                      @bind="Message" rows="6"></textarea>

            <div class="checkbox-row">
                <input id="selectAll" type="checkbox" @bind="SelectAllEmails" />
                <label for="selectAll">Selecionar todos os nomes ativos do banco de dados.</label>
            </div>

            <div class="actions">
                <button class="btn" @onclick="OnProceed" disabled="@(!CanProceed || IsSending)">
                    @if (IsSending)
                    {
                        <span class="loader" aria-hidden="true"></span>
                    }
                    <span>PROSSEGUIR</span>
                </button>
            </div>

            @if (!string.IsNullOrEmpty(Notification))
            {
                <div class="notification @NotificationType">@Notification</div>
            }
        </div>
    </div>
</div>

@code {
    private string Message { get; set; } = "";
    private bool SelectAllEmails { get; set; } = false;
    private bool IsSending { get; set; } = false;
    private string Notification { get; set; } = "";
    private string NotificationType { get; set; } = ""; // "success" or "error"

    // Habilita o botão apenas quando existir mensagem (mude se desejar outra regra)
    private bool CanProceed => !string.IsNullOrWhiteSpace(Message);

    private async Task OnProceed()
    {
        Notification = "";
        NotificationType = "";

        if (!CanProceed)
        {
            NotificationType = "error";
            Notification = "Por favor, digite uma mensagem antes de prosseguir.";
            return;
        }

        IsSending = true;
        try
        {
            // Simula envio. Aqui você chamaria sua API/serviço para enviar e-mails
            await Task.Delay(1000);

            // Exemplo de sucesso:
            NotificationType = "success";
            Notification = SelectAllEmails
                ? "Mensagem pronta para envio a todos os e-mails ativos."
                : "Mensagem salva. Selecione destinatários para enviar.";

            // Se quiser limpar:
            // Message = "";
            // SelectAllEmails = false;
        }
        catch (Exception ex)
        {
            NotificationType = "error";
            Notification = "Ocorreu um erro ao processar: " + ex.Message;
        }
        finally
        {
            IsSending = false;
        }
    }
}
